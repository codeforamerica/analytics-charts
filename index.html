<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- jQuery (Bootstrap requirement) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- D3 -->
<script src="https://d3js.org/d3.v4.min.js"></script>

<style>
.chart rect {
    fill: #ff9900;
}

.chart text {
    fill: black;
    font: 14px sans-serif;
    text-anchor: end;
}

.chart text.barlabel {
    fill: white;
}

.axis {
    color: #000000;
}
</style>

</head>
<body>

<script type="text/javascript">

var margin = {top: 20, right: 10, bottom: 20, left: 175}; // :TODO: set left margin dynamically based on label size
var labelPad = 5;
var barHeight = 25;
var width = 500 - margin.left - margin.right;

function buildBarChart(config) {
    data = config.values;
    metric = config.stat[0];
    var height = (barHeight * data.length) + margin.top + margin.bottom;

    var chart = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("class", "chart")
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var x = d3.scaleLinear()
        .domain([0, d3.max(data, function(d) { return d.value; })])
        .range([0, width]);

    var bar = chart.selectAll("g")
        .data(data)
      .enter().append("g")
        .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

    bar.append("rect")
        .attr("width", function(d) { return x(d.value) })
        .attr("height", barHeight - 1);

    bar.append("text")
        .attr("x", function(d) { return x(d.value) - labelPad; })
        .attr("y", barHeight / 2)
        .attr("dy", ".35em")
        .attr("class", "barlabel")
        .text(function(d) {
            if (metric == "percent") {
                return d3.format(".1f")(d.value) + "%"
            }
            return d.value;
        });

    var y = d3.scaleBand()
        .domain(data.map(function(d) { return d.name; }))
        .range([0, ((barHeight - 1) * data.length) + (data.length - 2)]);

    chart.append("g")
        .attr("class", "y axis")
        .call(
            d3.axisLeft(y)
                .tickSize(0)
                .tickPadding(labelPad)
        );
}

// get the data from a local file and display the chart
d3.json("data/sample-data.json", function(error, obj) {
    if (error) throw error;
    buildBarChart(obj)
})

</script>

</body>

</html>
